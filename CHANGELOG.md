# 更新日志

本项目的所有重要更改都将记录在此文件中。

## [1.0.1] - 2025-02-06

### 新增功能
- **强制压缩选项**：新增 `force_compression` 配置项，支持强制对所有图片进行压缩，无论原始大小如何
- **目标大小压缩**：新增 `target_size_kb` 配置项，支持指定压缩目标大小（KB），将图片尽可能压缩到指定大小以下

### 改进优化
- 优化压缩算法，支持更激进的压缩策略以快速达到目标大小
- **PNG自动转JPEG**：当PNG压缩后仍超过目标大小时，自动转换为JPEG格式以获得更好的压缩率
- **持续降低分辨率**：在每次质量压缩迭代中同时降低分辨率（80%/70%），质量越低缩放越激进
- **降低最小质量限制**：从10降低到5，允许更激进的压缩
- 质量下降步长增加到20（设置目标大小时），更快收敛到目标大小
- 完善压缩日志输出，显示压缩前后的文件大小对比

### 问题修复
- **修复GIF动图压缩格式问题**：GIF动图压缩后现在会保持GIF格式，不再转换为PNG
- **增强GIF动图压缩功能**：添加专门的GIF压缩方法，支持多种压缩策略
  - 使用配置中的 `target_size_kb` 作为压缩目标
  - 逐步缩小尺寸（100% → 40%）
  - 尝试减少颜色深度（256 → 32色）
  - 迭代压缩直到达到目标大小
- **优化处理流程**：调整 `process_image` 方法，先进行去重检测再压缩
  - 避免对重复图片进行无意义的压缩操作
  - 显著提升重复图片的处理性能
  - 日志更清晰：显示"跳过压缩和保存"

### 文档更新
- 更新 README.md，详细说明三种压缩模式（标准模式、强制压缩、目标大小压缩）
- 添加压缩配置优先级说明
- 补充配置示例和使用场景说明

### 配置项变更
- `_conf_schema.json` 新增 2 个配置项：
  - `force_compression`（布尔值，默认 false）
  - `target_size_kb`（整数，默认 0，范围 0-5000）

## [1.0.0] - 2025-02-05

### 初始版本
- 支持自动收集群友发送的图片
- 支持按用户分组存储图片
- 支持MD5精确去重
- 支持感知哈希相似去重（aHash、pHash、dHash、wHash）
- 支持自动压缩（尺寸压缩、质量压缩、格式优化）
- 支持GIF动图保留
- 支持随机回复功能
- 支持统计和查询指令（/图片统计、/我的图片）
- 提供 18 种配置选项，灵活控制插件行为

---

## 版本说明

版本号格式：`主版本号.次版本号.修订号`

- **主版本号**：不兼容的 API 修改
- **次版本号**：向下兼容的功能性新增
- **修订号**：向下兼容的问题修正